<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>KTV Controller</title>
</head>
<body style="background:#111; color:#eee; font-family:sans-serif; padding:20px;">

  <h1>ğŸ“± KTV Controllerï¼ˆé»æ­Œç«¯ï¼‰</h1>
  <input id="peerId" placeholder="è¼¸å…¥ Host Peer ID">
  <button onclick="connect()">é€£ç·š</button>
  <div id="conn-status"></div>

  <!-- æœå°‹å€å¡Š -->
  <h3>æœå°‹æ­Œæ›²</h3>
  <input id="search" placeholder="è¼¸å…¥æ­Œåæˆ–æ­Œæ‰‹">
  <button onclick="searchYT()">æœå°‹</button>
  <div id="results" style="margin-top:10px;"></div>

  <!-- æ§åˆ¶ -->
  <h3>æ§åˆ¶æ’­æ”¾</h3>
  <button onclick="sendToHost({type:'play'})">â–¶ æ’­æ”¾</button>
  <button onclick="sendToHost({type:'pause'})">â¸ æš«åœ</button>
  <button onclick="sendToHost({type:'next'})">â­ ä¸‹ä¸€é¦–</button>

  <!-- PeerJS -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <script>
    const API_KEY = "AIzaSyBOdPgWJQOZ1fswTgJRxA2RB3Awf_GrdAE"; // â† è«‹æ›æˆä½ çš„ API Key
    let peer, conn;

    peer = new Peer();
    function connect() {
      const hostId = document.getElementById("peerId").value.trim();
      conn = peer.connect(hostId);
      conn.on("open", () => {
        document.getElementById("conn-status").innerText = "âœ… å·²é€£ç·šåˆ° Host";
      });
    }

    function sendToHost(msg) {
      if (conn && conn.open) conn.send(msg);
      else alert("âŒ å°šæœªé€£ç·šåˆ° Host");
    }

    async function searchYT() {
      const query = document.getElementById("search").value.trim();
      if (!query) return alert("è«‹è¼¸å…¥é—œéµå­—");
      if (API_KEY === "YOUR_YOUTUBE_API_KEY") {
        alert("âš ï¸ è«‹å…ˆå¡«å…¥æœ‰æ•ˆçš„ YouTube API Keyï¼");
        return;
      }
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(query)}&key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.error) {
          alert("âŒ æœå°‹å¤±æ•—ï¼š" + data.error.message);
          console.error("API Error:", data.error);
          return;
        }
        const list = data.items.map(item => {
          const vid = item.id.videoId;
          const title = item.snippet.title.replace(/'/g, "");
          return `<div style="margin:5px 0; padding:5px; border-bottom:1px solid #444;">
            ğŸµ ${title}<br>
            <button onclick="enqueue('${vid}', '${title}')">ä½‡åˆ—</button>
            <button onclick="insertNext('${vid}', '${title}')">æ’æ’­</button>
          </div>`;
        }).join("");
        document.getElementById("results").innerHTML = list || "â€” æ²’æ‰¾åˆ°çµæœ â€”";
      } catch (err) {
        alert("âŒ æœå°‹è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– API Key");
        console.error("Fetch error:", err);
      }
    }

    function enqueue(videoId, title) {
      sendToHost({type:"enqueue", payload:{videoId, title}});
    }
    function insertNext(videoId, title) {
      sendToHost({type:"insertNext", payload:{videoId, title}});
    }
  </script>
</body>
</html>
