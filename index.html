<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Web KTV Demo</title>
</head>
<body style="background:#0b0f1a; color:#e8edf3; font-family:sans-serif;">

  <h1>🎤 Web KTV Demo</h1>
  <div id="status">⏳ 等待載入中…</div>

  <!-- YouTube Player -->
  <div id="player" style="margin-top:12px; width:100%; max-width:640px; aspect-ratio:16/9;"></div>

  <!-- 貼上 YouTube 連結 -->
  <div style="margin-top:12px;">
    <input id="url" placeholder="貼上 YouTube 連結" style="width:60%;" />
    <button onclick="loadVideo()">播放</button>
  </div>

  <!-- 載入 YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let isReady = false;

    // API 載入後會自動呼叫這個函式
    function onYouTubeIframeAPIReady() {
      console.log("✅ YouTube API 已載入");
      player = new YT.Player("player", {
        height: "360",
        width: "640",
        videoId: "", // 預設空
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      isReady = true;
      document.getElementById("status").innerText = "✅ 播放器已準備完成";
    }

    function onPlayerStateChange(event) {
      console.log("狀態改變：", event.data);
    }

    function loadVideo() {
      if (!isReady) {
        alert("播放器尚未準備好，請再試一次");
        return;
      }
      const url = document.getElementById("url").value.trim();
      const match = url.match(/(?:v=|youtu\.be\/)([0-9A-Za-z_-]{11})/);
      if (!match) {
        alert("無法解析 YouTube 連結");
        return;
      }
      player.loadVideoById(match[1]);
    }
  </script>
</body>
</html>
