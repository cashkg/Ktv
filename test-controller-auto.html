<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>TEST Controller Auto</title>
</head>
<body>
  <h2>TEST Controller Auto</h2>
  <div id="status">åˆå§‹åŒ–ä¸­...</div>

  <!-- PeerJS -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const hostId = params.get("host") || "ktv-host"; // é è¨­é€£ ktv-host
    const myName = "TestClient-" + Math.floor(Math.random()*1000);

    const statusEl = document.getElementById("status");
    function setStatus(msg){
      console.log(msg);
      statusEl.innerText = msg;
    }

    setStatus("ğŸ“¡ å˜—è©¦é€£ç·šåˆ° Host: " + hostId);

    const peer = new Peer(null, { 
      host:"0.peerjs.com", 
      port:443, 
      path:"/", 
      secure:true
    });

    peer.on("open", id=>{
      setStatus("âœ… PeerJS å·²å•Ÿå‹• (ID: "+id+")ï¼Œå˜—è©¦é€£ Host...");
      const conn = peer.connect(hostId);

      conn.on("open", ()=>{
        setStatus("ğŸ‰ å·²é€£ç·šåˆ° Host: " + hostId);
        conn.send({type:"register", name:myName});
      });

      conn.on("data", msg=>{
        setStatus("ğŸ“© æ”¶åˆ° Host è¨Šæ¯: " + JSON.stringify(msg));
      });

      conn.on("close", ()=>{
        setStatus("âŒ èˆ‡ Host æ–·ç·š");
      });

      conn.on("error", err=>{
        setStatus("âŒ é€£ç·šéŒ¯èª¤: " + err);
      });
    });

    peer.on("error", err=>{
      setStatus("âŒ PeerJS éŒ¯èª¤: " + err);
    });
  </script>
</body>
</html>
